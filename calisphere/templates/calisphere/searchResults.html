{% extends "calisphere/base.html"|pjax:request %}
{% load calisphere-extras %}
{% load staticfiles %}

{% block content %}

<p>Search > {{ q }}</p>

    <h2>Search Results / <strong>{{ q }}</strong></h2>

    <!-- Begin Refine Search Field and Filters -->

    <div class="row">
      
      <div class="col-xs-12 col-sm-12 col-md-3">
        <!-- Begin Refine Search Field -->
        {% include "calisphere/forms/refineQuery.html" %}
        <!-- End Refine Search Field -->
      </div>

      <div class="col-xs-12 col-sm-12 col-md-9">

        <!-- Begin Filter Component -->
        <div class="filter">

          <span class="filter__note">Filters you've selected:</span>
          
          {% for facet_type in FACET_TYPES %}
            {% for filter in filters|get_item:facet_type.0 %}
              <button type="button" class="btn btn-default btn-xs filter-pill button__close" data-slug="{{ filter|slugify }}">{{ filter }}<i class="fa fa-close button__close-icon"></i>
              </button>
            {% endfor %}
          {% endfor %}
          
          {% for refine in rq %}
            <input form="facet" type="hidden" name="rq" value="{{ refine }}">
            <button type="button" class="btn btn-default btn-xs refine-filter-pill button__close" data-slug="{{ refine }}">{{ refine }}<i class="fa fa-close button__close-icon"></i>
            </button>
          {% endfor %}

          <a class="filter__clear-all" href="#">Clear All</a>

        </div>
        <!-- End Filter Component -->

      </div>

    </div>

    <!-- End Refine Search Field and Filters -->

    <div class="row">

      <div class="col-xs-12 col-sm-12 col-md-3">
        <!-- Begin Checkbox Groups -->
        {% include "calisphere/forms/faceting.html" %}
        <!-- End Checkbox Groups -->
      </div>

      <div class="col-xs-12 col-sm-12 col-md-9">
          
        <div class="row object-view-row">
          
          <!-- TODO: facets.collection_name|length is only accurate if no collection filters have been applied -->
          <h3 class="text__collections-heading">{{ numFound }} Objects Found in <a href="#related-coll">{{ filters|get_item:'collection_name'|length }} OR {{ facets.collection_name|length }} Collections</a></h3>
          
          <!-- Begin Dropdown Pagination Component -->
          {% include "calisphere/forms/paginate.html" %}
          <!-- End Dropdown Pagination Component -->

          <!-- Begin Toggle Component -->

          <div class="thumblist-toggle">
            <input form="facet" type="hidden" id="view_format" name="view_format" value="{{ view_format }}">
            <button id="thumbnails" class="btn btn-link thumblist-toggle__thumbnails
            " href=""><span class="fa fa-th-large"></span>Thumbnails</button>
            <button id="list" class="btn btn-link thumblist-toggle__list" href=""><span class="fa fa-th-list"></span>List</button>
          </div>

          <!-- End Toggle Component -->

        </div>

        <!-- TODO: rewrite this form, POST bad. maintain state through javascript object -->
        <form id="item-view" action="/" method="post">
          {% csrf_token %}
          <input type="hidden" name="item_id" id="item_id" value=""/>
          <input type="hidden" name="q" value="{{ q }}"/>
          <input type="hidden" name="start" value="{{ start }}"/>
          {% if filters %}
            {% for facet_type in FACET_TYPES %}
              {% for filter in filters|get_item:facet_type.0 %}
                <input class="hidden" type="checkbox" name="{{ facet_type.0 }}" value="{{ filter }}" checked/>
              {% endfor %}
            {% endfor %}
          {% endif %}
        </form>
        
        <!-- Begin Thumbnail and List View Components -->
        
        {% if view_format == "thumbnails" %}
          {% include "calisphere/item-thumb.html" %}
        {% elif view_format == "list" %}
          {% include "calisphere/list-results.html" %}
        {% endif %}

        <!-- End Thumbnail and List View Components -->

        <!-- Begin Buttons Pagination Component -->
          {% include "calisphere/forms/paginate-buttons.html" %}
        <!-- End Buttons Pagination Component -->

        <!-- Begin Related Collections Component -->
          {% include "calisphere/related-collections.html" %}
        <!-- End Related Collections Component -->

    </div>
  </div>
    
{% endblock %}
