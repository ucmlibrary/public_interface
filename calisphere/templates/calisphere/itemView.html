{% extends "calisphere/base.html"|pjax:request %}
{% load calisphere-extras %}

{% block title %}: {{ item.title.0 }}{% endblock %}

{% block content %}

<div id="js-carouselContainer">
  <div class="carousel__search-results">
    {% if q %}
    Search results for "{{ q }}"
    {% endif %}
  </div>

  <div class="carousel__items-number">
    {{ numFound }} items found.
  </div>

  <form id="js-carousel" data-numfound="{{ numFound }}">
    <input type="hidden" name="q" value="{{ q }}" form="js-carousel">
    {% for refine in rq %}
    <input type="hidden" name="rq" value="{{ refine }}" form="js-carousel">
    {% endfor %}
    {% for filter_type in filters %}
      {% for filter in filters|get_item:filter_type %}
        {% if filter_type == 'collection_data' or filter_type == 'repository_data' %}
          <input type="hidden" class="js-filterType" name="{{ filter_type }}" value="{{ filter.id }}" form="js-carousel">
        {% else %}
          <input type="hidden" class="js-filterType" name="{{ filter_type }}" value="{{ filter|slugify }}" form="js-carousel">
        {% endif %}
      {% endfor %}
    {% endfor %}
  </form>

  <div class="carousel" data-carousel_start="{{ start }}">
    {% include "calisphere/carousel.html" %}
  </div>
</div>

<p class="text__breadcrumb-nav">
  {% if item.parsed_repository_data %}
    <a href="{% url 'calisphere:repositoryView' item.parsed_repository_data.0.id 'collections' %}">
      {% if item.parsed_repository_data.0.campus %}
        {{ item.parsed_repository_data.0.campus }},
      {% endif %}
      {{ item.parsed_repository_data.0.name }}
    </a>
  {% endif %}
   >
  {% if item.parsed_collection_data %}
     <a href="{% url 'calisphere:collectionView' item.parsed_collection_data.0.id %}">{{ item.parsed_collection_data.0.name }}</a>
  {% endif %}
   > {{ item.title.0 }}</p>

<h2 class="object__page-heading">{{ item.type.0 }}{% if item.structMap %} set{% else %}{% endif %} / <strong>{{ item.title.0|truncatewords:7 }}</strong></h2>

{% if item.harvest_type == 'harvested' %}
  {% if item.type_ss.0|lower == 'image' %}
    {% include 'calisphere/objectViewer/harvestedImage.html' %}
  {% else %}
    {% include 'calisphere/objectViewer/harvestedNonImage.html' %}
  {% endif %}
{% elif item.harvest_type == 'hosted' %}
  {% if item.structMap %}
    {% include 'calisphere/objectViewer/complex-object.html' %}
  {% elif item.type_ss.0|lower == 'image' %}
    {% include 'calisphere/objectViewer/hosted-simple-image.html' %}
  {% elif item.type_ss.0|lower == 'moving image' %}
  {% elif item.type_ss.0|lower == 'sound' %}
  {% elif item.type_ss.0|lower == "text"%}
    {% include 'calisphere/objectViewer/hosted-file.html' %}
  {% elif item.type_ss.0|lower == "complex object"%}
  {% endif %}
{% endif %}

<div class="modal fade" id="citationModal" tabindex="-1" role="dialog" aria-labelledby="citationModalTitle">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="citationModalTitle">Get Citation</h4>
        <p style="margin-bottom:0px">We recommend you include the following information in your citation. Look below the item for additional data you may want to include.</p>
      </div>
      <div class="modal-body">
        <textarea style="width: 100%; height: 11em;" onclick="this.focus();this.select()">
Title: {{ item.title.0 }}
{% if item.date.0 %}Date: {{ item.date.0 }}{% endif %}
Collection: {{ item.collection_name.0 }}
Owning Institution: {{ item.repository_name.0 }}
Source: Calisphere
Date of access: {% now "F j Y H:i" %}
Permalink: {% url 'calisphere:itemView' item.id %}</textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="contactOwnerModal" tabindex="-1" role="dialog" aria-labelledby="contactOwnerModalTitle">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="contactOwnerModalTitle">Contact Owning Institution</h4>
        <p style="margin-bottom:0px">All fields are required.</p>
        <div class="alert alert-warning" style="margin: 5px 5px 0 5px; padding: 5px 5px 5px 10px">
          <i class="fa fa-exclamation-triangle"></i> This feature coming soon.<br/>
          This form will enable users to contact owning institutions directly.
        </div>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-6">
              <div style="margin-right: 20px;">
                <div class="well well-sm">
                  {{ item.repository_name.0 }}<br/>
                  address@owning-institution.edu<br/>
                  (999) 999-9999<br/>
                  <a>http://owning-institution.edu</a>
                </div>
                <form>
                  <div class="form-group">
                    <label for="name">Name:</label>
                    <input type="text" class="form-control" id="name" placeholder="Your full name">
                  </div>
                  <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" class="form-control" id="email" placeholder="Your email">
                  </div>
                  <div class="form-group">
                    <label for="verifyEmail">Verify Email:</label>
                    <input type="email" class="form-control" id="verifyEmail" placeholder="Verify your email">
                  </div>
                  <div class="form-group">
                    <label for="demographic">How would you best describe yourself?</label>
                    <select id="demographic" class="form-control">
                      <option>K-12 teacher or librarian</option>
                      <option>K-12 student</option>
                      <option>College student</option>
                      <option>Graduate student</option>
                      <option>Faculty or Academic Researcher</option>
                      <option>Archivist or Librarian</option>
                      <option>Genealogist or family researcher</option>
                      <option>Other, please specify</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <input type="text" class="form-control" placeholder='If "Other," please specify'>
                  </div>
                </form>
              </div>
            </div>
            <div class="col-md-6" style="border-left: 1px solid black">
              <div style="margin-left: 20px;">
                <div class="well well-sm">Every item on Calisphere has been contributed to the site by a California institution. The institution can answer questions about this item, assit you with obtaining a hi-res copy, and gather additional information you may have about it. If you are experiencing technical issues, we'd request that you contact Calisphere directly.</div>
                <form>
                  <div class="form-group">
                    <div class="form-group">
                      <label for="request">Nature of Request</label>
                      <select id="request" class="form-control">
                        <option>Request high-resolution copy of item</option>
                        <option>Ask a copyright question</option>
                        <option>Get more information</option>
                        <option>Report an error</option>
                        <option>Leave a comment</option>
                      </select>
                    </div>
                    <div class="form-group">
                      RE: Calisphere: <i>request_reason</i> for {{ item.title.0 }}
                    </div>
                    <div class="form-group">
                      <label for="message">Message</label>
                      <textarea id="message" class="form-control" style="height: 7em"></textarea>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div style="float: left">
          <input type="checkbox"></input> Check to send a copy of this message to your email.
        </div>
        <div style="float: right">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary">Submit</button>
        </div>
      </div>
    </div>
  </div>
</div>

{% if item.harvest_type == 'hosted' %}
<div class="modal fade" id="downloadModal" tabindex="-1" role="dialog" aria-labelledby="downloadModalTitle">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="downloadModalTitle">Download Item</h4>
        <div class="alert alert-warning" style="margin: 5px 5px 0 5px; padding: 5px 5px 5px 10px">
          <i class="fa fa-exclamation-triangle"></i> This feature coming soon.<br/>
          Users will be able to download hosted content files via the download button below.
        </div>
      </div>
      <div class="modal-body">
        <p>Hold on a sec! Before you download, consider:</p>
        <p><strong>Do you have the rights to use it?</strong> Check the rights information for this item to see if it has copyright restrictions. Even if the item is protected by copyright, you may be able to use it for educational, research, or other purposes. To learn more, read Calisphere's <a href="{% url 'calisphere:termsOfUse' %}">terms of use.</a></p>
        <p><strong>Is this the version you want?</strong> This file is 1024 x 768 px and 518 kB. To obtain an alternate file type or higher resolution copy, please <a href="#" data-dismiss="modal">contact the owning institution.</a></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        {% if item.contentFile.format == 'file' %}
          <a type="button" class="btn btn-primary" href="{{ ucldcMedia }}{{ item.contentFile.id }}" target="_blank">Download</a>
        {% else %}
          <a type="button" class="btn btn-primary" href="">Download</a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endif %}

<div class="obj-buttons{% if item.structMap %}--complex{% endif %}">

  <div class="obj-buttons__group1">

    <a class="btn btn-xs obj-buttons__envelope" title="Email" href="javascript: void(0)">
      <span class="fa fa-envelope-o fa-fw"></span>
    </a>

    <a class="obj-buttons__twitter" title="Twitter" href="javascript: void(0)">
      <span class="fa fa-twitter-square"></span>
    </a>

    <a class="obj-buttons__facebook" title="Facebook" href="javascript: void(0)">
      <span class="fa fa-facebook-square"></span>
    </a>

    <a class="btn btn-xs obj-buttons__citation" href="javascript: void(0)" data-toggle="modal" data-target="#citationModal">
      Get Citation
    </a>

  </div>

  <div class="obj-buttons__group2">

    <span class="obj-buttons__contact-text">Need more information about this object? </span>

    <a class="btn btn-xs button__contact-owner" href="javascript: void(0)" data-toggle="modal" data-target="#contactOwnerModal">
      <span class="fa fa-envelope"></span>
      Contact Owner
    </a>

    {% if item.harvest_type == 'hosted' %}
      <a class="btn btn-xs obj-buttons__download-image" href="javascript: void(0)" data-toggle="modal" data-target="#downloadModal">
        <span class="icon__download-image">
          <span class="fa fa-arrow-circle-o-down"></span>
        </span> Download {{ item.type.0 }}
      </a>
    {% endif %}

  </div>

</div>

<h3 class="meta-heading__preview">
  {% if item.harvest_type == 'harvested' %}
    Metadata Preview. <a class="meta-heading__preview-link" href="{{ item.url_item }}">View complete record.</a>
  {% elif item.harvest_type == 'hosted' %}
    {% if item.structMap and item.selected == True %}
      Set Information.
    {% else %}
      Item Information.
    {% endif %}
  {% endif %}
</h3>

{% if item.selected == False %}
  {% include "calisphere/component-metadata.html" %}
{% else %}
<div class="meta-block">

  <dl class="meta-block__list">
    <dt class="meta-block__type">Title</dt>
    <dd class="meta-block__defin">{{ item.title.0 }}</dd>

    {% if item.alternative_title %}
      <dt class="meta-block__type">Alternative Title</dt>
      <dd class="meta-block__defin">{% for title in item.alternative_title %}{{ title }} <br> {% endfor %}</dd>
    {% endif %}

    {% if item.creator %}
      <dt class="meta-block__type">Creator</dt>
      <dd class="meta-block__defin">{% for creator in item.creator %}{{ creator }} <br> {% endfor %}</dd>
    {% endif %}

    {% if item.contributor %}
      <dt class="meta-block__type">Contributor</dt>
      <dd class="meta-block__defin">{% for contributor in item.contributor %}{{ contributor }} <br> {% endfor %}</dd>
    {% endif %}

    {% if item.date %}
      <dt class="meta-block__type">Date Created and/or Issued</dt>
      <dd class="meta-block__defin">{% for date in item.date %}{{ date }} <br> {% endfor %}</dd>
    {% endif %}

    {% if item.publisher %}
      <dt class="meta-block__type">Publisher</dt>
      <dd class="meta-block__defin">{% for publisher in item.publisher %}{{ publisher }} <br> {% endfor %}</dd>
    {% endif %}

    <!-- should include institution name: UC Berkely, Bancroft Library -->
    {% if item.parsed_repository_data %}
      <dt class="meta-block__type">Contributing Institution</dt>
      <dd class="meta-block__defin">
        {% for repository in item.parsed_repository_data %}
          <a href="{% url 'calisphere:repositoryView' repository.id 'collections' %}">
          {% if repository.campus %}
            {{ repository.campus }},
          {% endif %}
          {{ repository.name }}</a> <br>
        {% endfor %}
      </dd>
    {% endif %}

    {% if item.parsed_collection_data %}
      <dt class="meta-block__type">Collection</dt>
      <dd class="meta-block__defin">{% for collection in item.parsed_collection_data %}<a href="{% url 'calisphere:collectionView' collection.id %}">{{ collection.name }}</a> <br> {% endfor %}</dd>
    {% endif %}

    {% if item.rights %}
      <dt class="meta-block__type">Rights Information</dt>
			<dd class="meta-block__defin">{% for rights in item.rights %}{{ rights }} <br>{% endfor %}</dd>
    {% endif %}

    {% if item.rights_holder %}
			<dt class="meta-block__type">Rights Holder and Contact</dt>
			<dd class="meta-block__defin">{% for rights_holder in item.rights_holder %}{{ rights_holder }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.rights_note %}
			<dt class="meta-block__type">Rights Notes</dt>
			<dd class="meta-block__defin">{% for rights_note in item.rights_note %}{{ rights_note }} <br> {% endfor %}</dd>
		{% endif %}

    <!-- rights date is not currently multivalued -->
    {% if item.rights_date %}
			<dt class="meta-block__type">Date of Copyright</dt>
			<dd class="meta-block__defin">{{ item.rights_date }} <br> </dd>
		{% endif %}

    {% if item.description %}
			<dt class="meta-block__type">Description</dt>
			<dd class="meta-block__defin">{% for description in item.description %}{{ description }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.type %}
			<dt class="meta-block__type">Type</dt>
			<dd class="meta-block__defin">{% for type in item.type %}{{ type }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.format %}
			<dt class="meta-block__type">Format</dt>
			<dd class="meta-block__defin">{% for format in item.format %}{{ format }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.genre %}
			<dt class="meta-block__type">Form/Genre</dt>
			<dd class="meta-block__defin">{% for genre in item.genre %}{{ genre }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.extent %}
			<dt class="meta-block__type">Extent</dt>
			<dd class="meta-block__defin">{% for extent in item.extent %}{{ extent }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.identifier %}
			<dt class="meta-block__type">Identifier</dt>
			<dd class="meta-block__defin">{% for identifier in item.identifier %}{{ identifier }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.language %}
			<dt class="meta-block__type">Language</dt>
			<dd class="meta-block__defin">{% for language in item.language %}{{ language }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.subject %}
      <dt class="meta-block__type">Subject</dt>
			<dd class="meta-block__defin">{% for subject in item.subject %}{{ subject }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.temporal %}
			<dt class="meta-block__type">Time Period</dt>
			<dd class="meta-block__defin">{% for temporal in item.temporal %}{{ temporal }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.coverage %}
			<dt class="meta-block__type">Place</dt>
			<dd class="meta-block__defin">{% for coverage in item.coverage %}{{ coverage }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.source %}
			<dt class="meta-block__type">Source</dt>
			<dd class="meta-block__defin">{% for source in item.source %}{{ source }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.relation %}
			<dt class="meta-block__type">Relation</dt>
			<dd class="meta-block__defin">{% for relation in item.relation %}{{ relation }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.provenance %}
			<dt class="meta-block__type">Provenance</dt>
			<dd class="meta-block__defin">{% for provenance in item.provenance %}{{ provenance }} <br> {% endfor %}</dd>
		{% endif %}

    {% if item.location %}
			<dt class="meta-block__type">Location</dt>
			<dd class="meta-block__defin">{% for location in item.location %}{{ location }} <br> {% endfor %}</dd>
		{% endif %}
  </dl>

</div>
{% endif %}

<div class="related-coll--search-results-page" id="js-relatedCollections">
  {% include "calisphere/related-collections.html" %}
</div>

<!--
  header returned from solr; for debugging
  {{ item_solr_search.header|safe }}
  -->
{% endblock %}

{% block footerScripts %}
  <script type="text/javascript">
    var conf = {
      infinite: false,
      speed: 300,
      slidesToShow: 20,
      slidesToScroll: 6,
      variableWidth: true,
      lazyLoad: 'ondemand',
      responsive: [
        {
          breakpoint: 1200,
          settings: {
            infinite: true,
            // slidesToShow: 8,
            slidesToScroll: 8,
            variableWidth: true
          }
        },
        {
          breakpoint: 900,
          settings: {
            infinite: true,
            // slidesToShow: 6,
            slidesToScroll: 6,
            variableWidth: true
          }
        },
        {
          breakpoint: 650,
          settings: {
            infinite: true,
            // slidesToShow: 4,
            slidesToScroll: 4,
            variableWidth: true
          }
        }
      ]
    };

    $(document).ready(function() {
      if ($('.carousel-complex').length > 0) {
        $('.carousel-complex').show();
        $('.carousel-complex__item-container').slick(conf);

        $(document).on('click', '.js-component-link', function(query) {
          return function(event) {
            var data_params = {
              'order': $(this).data('item_id'),
              'q': "{{ q }}",
              {% if rq|length > 0 %}
              'rq': "{{ rq }}",
              {% endif %}
              'start': "{{ start }}"
            }
            for (var i in query.filters) { data_params[i] = query.filters[i]; }

            event.preventDefault();
            $.pjax({
              type: 'GET',
              url: $(this).attr('href'),
              container: query.resultsContainer,
              data: data_params,
              traditional: true
            });
          }
        }(query));
      }
    });
  </script>
{% endblock %}
